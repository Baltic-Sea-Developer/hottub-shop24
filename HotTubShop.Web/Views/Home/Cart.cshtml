@model CartViewModel
@{
    ViewData["Title"] = Model.Language == "en" ? "Cart" : "Warenkorb";
}

<h1 class="h3 mb-3">@ViewData["Title"]</h1>

@if (!(User?.Identity?.IsAuthenticated ?? false))
{
    var justAdded = (TempData["ShowRegisterPrompt"] as string) == "1";
    <section class="alert alert-info">
        <strong>@(justAdded
            ? (Model.Language == "en" ? "Item added to cart." : "Artikel wurde in den Warenkorb gelegt.")
            : (Model.Language == "en" ? "Optional account:" : "Optionales Kundenkonto:"))</strong>
        @if (justAdded)
        {
            <br />
        }
        @(Model.Language == "en"
            ? " create an account to unlock full pricing visibility and faster follow-up orders."
            : " Lege ein Kundenkonto an, um volle Preisansicht und schnellere Folge-Bestellungen zu erhalten.")
        <div class="mt-2 d-flex gap-2">
            <a class="btn btn-sm btn-outline-primary" asp-area="Identity" asp-page="/Account/Register" asp-route-returnUrl="@Url.Action("Cart", "Home", new { lang = Model.Language })">@(Model.Language == "en" ? "Create account" : "Konto anlegen")</a>
            <a class="btn btn-sm btn-outline-secondary" asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="@Url.Action("Cart", "Home", new { lang = Model.Language })">@(Model.Language == "en" ? "Login" : "Anmelden")</a>
        </div>
    </section>
}

@if (Model.Items.Count == 0)
{
    <section class="product-card p-4">
        <p class="mb-0">@(Model.Language == "en" ? "Your cart is empty." : "Dein Warenkorb ist leer.")</p>
    </section>
}
else
{
    <div class="d-grid gap-3">
        @for (var i = 0; i < Model.Items.Count; i++)
        {
            var item = Model.Items[i];
            <article class="product-card p-3 p-lg-4">
                <div class="d-flex justify-content-between align-items-start gap-3">
                    <div>
                        <h2 class="h5 mb-2">@item.ProductName</h2>
                        <ul class="mb-2">
                            @foreach (var option in item.SelectedOptions)
                            {
                                <li>
                                    @option.LocalizedName(Model.Language) (+@option.PriceDelta.ToString("N0") EUR)
                                    @if (!string.IsNullOrWhiteSpace(option.LocalizedDescription(Model.Language)))
                                    {
                                        <div class="small text-muted">@Html.Raw(option.LocalizedDescription(Model.Language))</div>
                                    }
                                </li>
                            }
                        </ul>
                        <strong>@item.TotalPrice.ToString("N0") EUR</strong>
                    </div>
                    <form method="post" asp-action="RemoveFromCart">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="index" value="@i" />
                        <input type="hidden" name="lang" value="@Model.Language" />
                        <button type="submit" class="btn btn-outline-danger btn-sm">@(Model.Language == "en" ? "Remove" : "Entfernen")</button>
                    </form>
                </div>
            </article>
        }
    </div>

    <section class="product-card p-3 p-lg-4 mt-3 d-flex justify-content-between align-items-center">
        <strong>@(Model.Language == "en" ? "Total" : "Gesamt"): @Model.Total.ToString("N0") EUR</strong>
        <a class="btn btn-primary" asp-action="Checkout" asp-route-lang="@Model.Language">@(Model.Language == "en" ? "Checkout" : "Zur Kasse")</a>
    </section>
}
